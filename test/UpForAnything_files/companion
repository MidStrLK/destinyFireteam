var SimpleDialogKO=function(n){SimpleDialog.call(this,n)},SimpleDialogKOGrimoire;SimpleDialogKO.prototype=Object.create(SimpleDialog.prototype);SimpleDialogKO.prototype.Init=function(){if(typeof this.$el.data("simpleDialog")!="undefined"){this.$el.data("simpleDialog").Open();return}this.createElements();this.parseSizes();this.addListeners();this.Update();this.autoOpen&&this.Open();this.storeData()};SimpleDialogKO.prototype.createElements=function(){var n=this,i,t;n.$el.attr("class")!==""&&(i=n.$el.attr("class").replace(/\s/gi,"SimpleDialog ")+"SimpleDialog");t=n.$el.attr("id");this.newId=t;this.$container=this.$el;this.$dialog=this.$el.find(".simpleDialog");this.$contents=this.$el.find(".simpleDialogContent")};SimpleDialogKO.prototype.Open=function(){SimpleDialog.prototype.Open.call(this);var n=this;n.$dialog.find(".closeSimpleDialog").on("click",function(){n.Close()})};SimpleDialogKOGrimoire=function(n){SimpleDialogKO.call(this,n)};SimpleDialogKOGrimoire.prototype=Object.create(SimpleDialogKO.prototype);SimpleDialogKOGrimoire.prototype.Close=function(){SimpleDialogKO.prototype.Close.call(this);viewModels.currentGrimoireCardRaw(null)};viewModels.currentGrimoireCardRaw=ko.observable(null);viewModels.determineGrimoireCardBonus=function(n){var t={hasBonus:!1,hasCompletedBonus:!1},e,r,u,i,o,f,s;try{if(!n.statisticCollection)return t;for(e=n.statisticCollection.length,r=0;r<e;r++)if(u=n.statisticCollection[r],i=u.statDef,i&&i.rankCollection!==undefined)for(o=i.rankCollection.length,j=0;j<o;j++)f=i.rankCollection[j],n.cardDef.bonusRank!==undefined&&(t.hasBonus=!0,s=n.cardDef.bonusRank,s.rank===f.rank&&u.value>=f.threshold&&(t.hasCompletedBonus=!0,t.hasBonus=!1));return t}catch(h){return Bnet.error(h),t}};viewModels.determineGrimoireCardBackground=function(n){var t=n.cardDef.highResolution.image.sheetPath;return"url("+t+") 0 0 no-repeat"};viewModels.processGrimoireCardRanks=function(n,t,i){var u,r;try{if(t.rankCollection===undefined)return t;var e=i.bonusRank,s=t.rankCollection.length,f=0,o=0;for(u=0;u<s;u++)r=t.rankCollection[u],r.isComplete=n.value>=r.threshold,r.isStarted=f===0,r.progressString=r.isComplete?Localizer.Grimoire_ui.rankcomplete:n.value+"/"+r.threshold,r.isStarted||(r.progressString=r.threshold),n.value>=r.threshold&&o++,r.isActive=!1,r.isInProgress=!1,e.rank===r.rank&&(n.value>=r.threshold?r.isActive=!0:(e.rank===1||o>0)&&(r.isInProgress=!0)),f=r.isComplete?f:r.rank;return t}catch(h){Bnet.log(h)}};viewModels.processGrimoireCardStatistics=function(n){var e,o,i,r,t,u,f;try{if(n.statisticCollection===undefined)return null;for(e=n.statisticCollection.length,o=n.cardDef.statisticCollection.length,i=0;i<e;i++){for(r=n.statisticCollection[i],t=null,u=0;u<o;u++)f=n.cardDef.statisticCollection[u],r.statNumber===f.statNumber&&(t=f);t&&(t=viewModels.processGrimoireCardRanks(r,t,n.cardDef));r.statDef=t}return n.statisticCollection}catch(s){Bnet.log(s)}};viewModels.processGrimoireCardData=function(n){var t,i,r;try{t=n.data.cardCollection.length?n.data.cardCollection[0]:{};t.cardDef=null;for(i in n.cardDefinitions)n.cardDefinitions.hasOwnProperty(i)&&(t.cardDef=n.cardDefinitions[i]);return t.cardDef&&(t.cardBackground=viewModels.determineGrimoireCardBackground(t),t.hasIntro=t.cardDef.cardIntro!==undefined,t.hasAttribution=t.cardDef.cardIntroAttribution!==undefined),n.data.cardCollection.length&&(r=viewModels.determineGrimoireCardBonus(t),t.statisticCollection=viewModels.processGrimoireCardStatistics(t),t.hasBonus=r.hasBonus,t.hasCompletedBonus=r.hasCompletedBonus,t.hasStats=t.statisticCollection!==undefined),t}catch(u){Utility.alert(Localizer.Legend.unabletoloadthisgrimoire);Bnet.log(u)}};viewModels.currentGrimoireCard=ko.computed(function(){var n=viewModels.currentGrimoireCardRaw();return n?viewModels.processGrimoireCardData(n):null});viewModels.currentGrimoireCardRendered=function(){if(viewModels.currentGrimoireCard()){var n=$(".dynamicGrimoireCard"),t=new GrimoireCard(n);n.addClass("ready")}}